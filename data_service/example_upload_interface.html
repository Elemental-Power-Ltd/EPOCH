<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload with Metadata</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>File Upload with Metadata</h1>
    <form action="http://localhost:8000/upload-meter-data/" method="post" enctype="multipart/form-data">
        <label for="file">Select a file:</label>
        <input type="file" id="file" name="file" required><br><br>
        
        <label for="client">Client:</label>
        <select id="client" name="client" required>
            <option value="">Select client</option>
        </select><br><br>
        
        <label for="site">Site:</label>
        <select id="site" name="site_id" required>
            <option value="">Select site</option>
        </select><br><br>
        
        <label for="fuel_type">Fuel Type:</label>
        <select id="fuel_type" name="fuel_type" required>
            <option value="">Select fuel type</option>
            <option value="gas">Gas</option>
            <option value="elec">Elec</option>
        </select><br><br>
        
        <input type="submit" value="Upload">
    </form>

    <script>
        $(document).ready(function() {
            // Fetch clients
			$.ajax({
				url: 'http://127.0.0.1:8000/get-clients',
				type: 'POST',
				contentType: 'application/json',
				success: function(data) {
					var clientDropdown = $('#client');
					clientDropdown.empty();
					clientDropdown.append($('<option></option>')
						.attr('value', '')
						.text('Select client'));
					$.each(data, function(index, client) {
						clientDropdown.append($('<option></option>')
							.attr('value', client.client_id)
							.text(client.name));
					});
				}
			});

            // Fetch sites when client is selected
            $('#client').change(function() {
                var clientId = $(this).val();
                if (clientId) {
                    $.ajax({
                        url: 'http://127.0.0.1:8000/get-sites',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({ client_id: clientId }),
                        success: function(data) {
                            var siteDropdown = $('#site');
                            siteDropdown.empty();
                            siteDropdown.append($('<option></option>')
                                .attr('value', '')
                                .text('Select site'));
                            $.each(data, function(index, site) {
                                siteDropdown.append($('<option></option>')
                                    .attr('value', site.site_id)
                                    .text(site.name));
                            });
                        }
                    });
                } else {
                    $('#site').empty().append($('<option></option>')
                        .attr('value', '')
                        .text('Select site'));
                }
            });
        });
    </script>
</body>
</html>