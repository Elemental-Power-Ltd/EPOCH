<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Simulation Form</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 40px;
    }

    fieldset {
        margin-bottom: 20px;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 6px;
    }

    legend {
        font-weight: bold;
        padding: 0 8px;
    }

    /* Two fields per row */
    fieldset {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px 25px;
    }

    /* Make headings span full width */
    fieldset h4 {
        grid-column: 1 / -1;
        margin-bottom: 5px;
    }

    /* Labels stack text + input vertically */
    label {
        display: flex;
        flex-direction: column;
        font-size: 14px;
    }

    input, select {
        padding: 6px;
        margin-top: 5px;
        width: 100%;
        box-sizing: border-box;
    }

    button {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 16px;
    }

    table {
        border-collapse: collapse;
        margin-top: 30px;
        width: 100%;
    }

    th, td {
        border: 1px solid #ccc;
        padding: 10px 12px;
        text-align: center;
    }

    th {
        background-color: #f4f4f4;
    }

    #results {
        display: none;
    }

    @media (max-width: 700px) {
    fieldset {
        grid-template-columns: 1fr;
    }
}

</style>

</head>
<body>

<h2>Energy Simulation</h2>

<form id="simulationForm">

    <fieldset>
        <legend>Site</legend>
        <label>Location:
            <select id="location">
                <option value="Cardiff">Cardiff</option>
                <option value="London">London</option>
                <option value="Edinburgh">Edinburgh</option>
            </select>
        </label>

        <label>Building Type:
            <select id="building">
                <option value="Domestic">Domestic</option>
                <option value="TownHall">TownHall</option>
                <option value="LeisureCentre">LeisureCentre</option>
            </select>
        </label>
    </fieldset>

    <fieldset>
        <legend>Solar Panels (2 arrays)</legend>

        <h4>Panel 1</h4>
        <label>Peak Power (kW):
            <input type="number" id="solar1_peak" min="0" step="0.1" value="2.5" required>
        </label>
        <label>Direction:
            <select id="solar1_direction">
                <option>North</option>
                <option>East</option>
                <option selected>South</option>
                <option>West</option>
            </select>
        </label>

        <h4>Panel 2</h4>
        <label>Peak Power (kW):
            <input type="number" id="solar2_peak" min="0" step="0.1" value="1.0" required>
        </label>
        <label>Direction:
            <select id="solar2_direction">
                <option selected>North</option>
                <option>East</option>
                <option>South</option>
                <option>West</option>
            </select>
        </label>
    </fieldset>

    <fieldset>
        <legend>Heating</legend>
        <label>Heat Power (kW):
            <input type="number" id="heat_power" min="0.1" step="0.1" value="10.0" required>
        </label>
        <label>Heat Source:
            <select id="heat_source">
                <option value="Boiler">Boiler</option>
                <option value="HeatPump">HeatPump</option>
            </select>
        </label>
    </fieldset>

    <fieldset>
        <legend>Insulation</legend>
        <label><input type="checkbox" id="double_glazing"> Double Glazing</label>
        <label><input type="checkbox" id="cladding"> Cladding</label>
        <label><input type="checkbox" id="loft"> Loft Insulation</label>
    </fieldset>

    <fieldset>
        <legend>Battery (Optional)</legend>
        <label>Capacity (kWh):
            <input type="number" id="battery_capacity" min="0" step="0.1">
        </label>
        <label>Power (kW):
            <input type="number" id="battery_power" min="0" step="0.1">
        </label>
    </fieldset>

    <fieldset>
        <legend>Grid</legend>
        <label>Import Tariff:
            <select id="import_tariff">
                <option>Fixed</option>
                <option>Agile</option>
                <option>Peak</option>
                <option>Overnight</option>
            </select>
        </label>

        <label>Export Tariff (£/kWh):
            <input type="number" id="export_tariff" min="0" step="0.01" value="0.05" required>
        </label>
    </fieldset>

    <button type="submit">Run Simulation</button>

</form>

<div id="results">
    <h3>Simulation Results</h3>
    <table>
        <tr>
            <th>Total Spend (£)</th>
            <th>Scope 1 Carbon Savings (kgCO2e)</th>
            <th>Scope 2 Carbon Savings (kgCO2e)</th>
            <th>Return on Investment (%)</th>
        </tr>
        <tr>
            <td id="capex"></td>
            <td id="scope1"></td>
            <td id="scope2"></td>
            <td id="roi"></td>
        </tr>
    </table>
</div>

<script>
document.getElementById("simulationForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const batteryCapacity = document.getElementById("battery_capacity").value;
    const batteryPower = document.getElementById("battery_power").value;

    const requestBody = {
        location: document.getElementById("location").value,
        building: document.getElementById("building").value,
        panels: [
            {
                solar_peak: parseFloat(document.getElementById("solar1_peak").value),
                direction: document.getElementById("solar1_direction").value
            },
            {
                solar_peak: parseFloat(document.getElementById("solar2_peak").value),
                direction: document.getElementById("solar2_direction").value
            }
        ],
        heat: {
            heat_power: parseFloat(document.getElementById("heat_power").value),
            heat_source: document.getElementById("heat_source").value
        },
        insulation: {
            double_glazing: document.getElementById("double_glazing").checked,
            cladding: document.getElementById("cladding").checked,
            loft: document.getElementById("loft").checked
        },
        battery: batteryCapacity && batteryPower ? {
            capacity: parseFloat(batteryCapacity),
            power: parseFloat(batteryPower)
        } : null,
        grid: {
            import_tariff: document.getElementById("import_tariff").value,
            export_tariff: parseFloat(document.getElementById("export_tariff").value)
        },
        full_reporting: false
    };

    try {
        const response = await fetch("/simulate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(requestBody)
        });

        if (!response.ok) {
            throw new Error("Simulation failed");
        }

        const data = await response.json();

        document.getElementById("capex").innerText = data.metrics.capex.toFixed(2);
        document.getElementById("scope1").innerText = data.metrics.carbon_balance_scope_1.toFixed(2);
        document.getElementById("scope2").innerText = data.metrics.carbon_balance_scope_2.toFixed(2);
        document.getElementById("roi").innerText = data.metrics.return_on_investment.toFixed(2);

        document.getElementById("results").style.display = "block";

    } catch (error) {
        alert("Error running simulation.");
        console.error(error);
    }
});
</script>

</body>
</html>
